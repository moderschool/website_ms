<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern School Assistant</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root { --maroon: #800000; --gold: #c5a059; --bg: #fdfdfd; }
        * { box-sizing: border-box; font-family: 'Inter', sans-serif; }
        
        /* Vibration Animation */
       /* Vibration Animation restricted to just the icon */
@keyframes icon-shake {
    0% { transform: rotate(0deg); }
    10% { transform: rotate(-15deg); }
    20% { transform: rotate(15deg); }
    30% { transform: rotate(-15deg); }
    40% { transform: rotate(15deg); }
    50% { transform: rotate(0deg); }
    100% { transform: rotate(0deg); }
}

/* Launcher Container (Removed animation from here) */
#launcher {
    position: fixed;
    right: 30px;
    bottom: 0;
    background: var(--maroon);
    color: white;
    padding: 7px 15px;
    border-radius: 10px 10px 0 0;
    cursor: pointer;
    box-shadow: 0 -4px 12px rgba(0,0,0,0.15);
    z-index: 1000;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s ease;
    border: 1.5px solid rgba(255,255,255,0.3);
    border-bottom: none;
}

/* Target only the icon for vibration */
#launcher i { 
    font-size: 14px; 
    display: inline-block; /* Required for transform to work */
    animation: icon-shake 4s ease-in-out infinite;
}

#launcher:hover { 
    background: #990000; 
    padding-bottom: 15px; 
}

/* Stop icon vibration on hover */
#launcher:hover i {
    animation: none;
}
        /* Chat Card */
        #chat-card {
            position: fixed; 
            bottom: 20px; 
            right: 30px;
            width: 330px; 
            height: 420px;
            background: white; 
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            display: none; 
            flex-direction: column; 
            z-index: 1001; 
            overflow: hidden;
            border: 1px solid #eee;
        }

        .header {
            background: var(--maroon); color: white; padding: 7px 18px;
            display: flex; align-items: center; gap: 8px; border-bottom: 2px solid var(--gold);
            position: relative;
        }
        
        .min-btn {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            font-size: 18px;
            opacity: 0.7;
        }
        .min-btn:hover { opacity: 1; }

        #exec-img-container { 
            width: 35px; height: 35px; background: white; border-radius: 50%; 
            display: none; align-items: center; justify-content: center; overflow: hidden;
        }

        .header-info h3 { margin: 0; font-size: 14px; font-weight: 600; }
        .header-info span { font-size: 11px; opacity: 0.8; }

        #feature-bar {
            display: none; background: #fffcf0; padding: 8px;
            border-bottom: 1px solid #eee; justify-content: space-around;
        }
        .bar-link { font-size: 11px; font-weight: 600; color: var(--maroon); cursor: pointer; display: flex; align-items: center; gap: 4px; }

        .body { height: 400px; overflow-y: auto; padding: 15px; background: var(--bg); display: flex; flex-direction: column; gap: 10px; }
        .msg { padding: 10px 14px; font-size: 13px; line-height: 1.4; max-width: 85%; border-radius: 10px; }
        .bot { background: white; border: 1px solid #eee; align-self: flex-start; color: #333; }
        .user { background: var(--maroon); color: white; align-self: flex-end; }

        .chip-box { display: flex; flex-wrap: wrap; gap: 6px; }
        .chip {
            background: white; border: 1px solid var(--maroon); color: var(--maroon);
            padding: 5px 12px; border-radius: 15px; cursor: pointer; font-size: 11px; font-weight: 500;
        }
        .chip:hover { background: var(--maroon); color: white; }

        .rating-box { text-align: center; padding: 20px; }
        .stars { font-size: 24px; color: #ddd; cursor: pointer; margin: 0 4px; }
        .stars.active { color: var(--gold); }

        .footer { padding: 10px; border-top: 1px solid #eee; display: flex; gap: 8px; align-items: center; }
        .footer input { flex: 1; border: none; outline: none; font-size: 13px; padding: 5px; }
   /* Blinking Green Dot */
.blink-dot {
    height: 8px;
    width: 8px;
    background-color: #2ecc71;
    border-radius: 50%;
    display: inline-block;
    margin-left: 5px;
    box-shadow: 0 0 0 rgba(46, 204, 113, 0.4);
    animation: pulse 1.5s infinite;
    vertical-align: middle;
}

@keyframes pulse {
    0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(46, 204, 113, 0.7); }
    70% { transform: scale(1); box-shadow: 0 0 0 6px rgba(46, 204, 113, 0); }
    100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(46, 204, 113, 0); }
}
 </style>
</head>
<body>

<div id="launcher" onclick="openChat()">
    <i class="fas fa-headset"></i>
    <span>Assist</span>
</div>

<div id="chat-card">
    <div class="header">
        <div id="exec-img-container">
            <svg viewBox="0 0 24 24" width="24" height="24"><path fill="#800000" d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z" /></svg>
        </div>
     <div class="header-info">
    <h3 id="h-title">Modern School</h3>
    <span id="h-status"> Modest is Live <span class="blink-dot"></span></span>
</div>
        <i class="fas fa-minus min-btn" onclick="closeChat()"></i>
    </div>

    <div id="feature-bar">
        <span class="bar-link" onclick="handleCallbackRequest()"><i class="fas fa-phone-alt"></i> Call-Back</span>
        <span class="bar-link" onclick="triggerRating()"><i class="fas fa-times-circle"></i> End Chat</span>
    </div>
    
    <div class="body" id="flow"></div>

    <div class="footer" id="chat-footer">
        <input type="text" id="user-in" placeholder="Ask a question..." onkeypress="checkKey(event)">
        <i class="fas fa-paper-plane" style="color:var(--maroon); cursor:pointer;" onclick="sendInput()"></i>
    </div>
</div>

<script>
    const flow = document.getElementById('flow');
    const chatCard = document.getElementById('chat-card');
    const launcher = document.getElementById('launcher');
    const userIn = document.getElementById('user-in');
    const featureBar = document.getElementById('feature-bar');
    const execImgContainer = document.getElementById('exec-img-container');

    let userData = { name: "", mobile: "" };
    let captureStep = 0; 
    let isConnectedToExec = false;

    const subTopics = {
        "Admissions": ["Fee Structure", "Admission Process", "Visit Campus"],
        "Academics": ["Curriculum", "Faculty", "Board Results"],
        "Facilities": ["Library & Labs", "Smart Classes", "Cafeteria"],
        "Sports": ["Coaching", "Infrastructure"],
        "Transport": ["Routes", "Safety"]
    };

    function openChat() {
        chatCard.style.display = 'flex';
        launcher.style.display = 'none';
        if(flow.children.length === 0) showMainBot();
    }

    function closeChat() {
        chatCard.style.display = 'none';
        launcher.style.display = 'flex';
    }

    function showMainBot() {
        flow.innerHTML = "";
        userData = { name: "", mobile: "" };
        captureStep = 0;
        isConnectedToExec = false;
        document.getElementById('chat-footer').style.display = "flex";
        featureBar.style.display = "none";
        execImgContainer.style.display = "none";
        document.getElementById('h-title').innerText = "Modern School";

        addMsg("Namaste! Welcome to <b>Modern School</b>. How can I assist you today?", "bot");
        addChips(["Admissions", "Academics", "Facilities", "Sports", "Transport", "Speak to Executive"]);
    }

    function handleLogic(choice) {
        if (captureStep > 0) return;
        addMsg(choice, "user");

        if(choice === "Speak to Executive") {
            captureStep = 1;
            addMsg("To connect you with <b>Ms. Ankita Suri</b>, please provide your <b>Full Name</b>.", "bot");
            return;
        }

        if(subTopics[choice]) {
            setTimeout(() => {
                addMsg(`What would you like to know about <b>${choice}</b>?`, "bot");
                addChips([...subTopics[choice], "Main Menu"]);
            }, 500);
        } else {
            setTimeout(() => {
                addMsg(`I've shared the info for <b>${choice}</b>.`, "bot");
                askHelpful();
            }, 500);
        }
    }

    function askHelpful() {
        setTimeout(() => {
            addMsg("<b>Was this helpful?</b>", "bot");
            addChips(["Yes, thanks!", "No, Speak to Executive", "Main Menu"]);
        }, 800);
    }

    function handleCapture(val) {
        if(captureStep === 1) {
            userData.name = val;
            addMsg(val, "user");
            setTimeout(() => { addMsg(`Thanks ${val}. Enter your <b>Mobile Number</b>.`, "bot"); captureStep = 2; }, 600);
        } else if(captureStep === 2) {
            if(!/^\d{10}$/.test(val)) { addMsg("Enter a valid 10-digit number.", "bot"); return; }
            userData.mobile = val;
            addMsg(val, "user");
            captureStep = 0;
            startLiveTimer();
        }
    }

    function startLiveTimer() {
        addMsg("Connecting to counselor...", "bot");
        const div = document.createElement('div');
        div.className = "msg bot";
        div.style.background = "#fff9e6";
        div.innerHTML = `<i class="fas fa-headset"></i> Connecting to <b>Ms. Ankita Suri</b> in <b id='tm'>10</b>s`;
        flow.appendChild(div);
        
        let time = 10;
        const timer = setInterval(() => {
            time--;
            if(document.getElementById('tm')) document.getElementById('tm').innerText = time;
            if(time <= 0) {
                clearInterval(timer);
                div.remove();
                connectExecutive();
            }
        }, 1000);
    }

    function connectExecutive() {
        isConnectedToExec = true;
        execImgContainer.style.display = "flex";
        document.getElementById('h-title').innerText = "Ms. Ankita Suri";
        document.getElementById('h-status').innerHTML = "ðŸŸ¢ Active | Counselor";
        featureBar.style.display = "flex";
        addMsg(`Hello ${userData.name}! I am <b>Ankita Suri</b>. How can I help you today?`, "bot");
    }

    function handleCallbackRequest() {
        addMsg("Request Callback", "user");
        setTimeout(() => {
            addMsg(`Callback confirmed for <b>+91 ${userData.mobile}</b>.`, "bot");
            addMsg("ðŸ•’ You will receive a call within <b>24 working hours</b>.", "bot");
            addMsg("You can continue chatting or end the session.", "bot");
            addChips(["End Chat", "Main Menu"]);
        }, 800);
    }

    function triggerRating() {
        featureBar.style.display = "none";
        document.getElementById('chat-footer').style.display = "none";
        flow.innerHTML = `
            <div class="rating-box">
                <p style="font-weight:600; color:var(--maroon);">Rate your experience</p>
                <div style="margin:15px 0;">
                    <i class="fas fa-star stars" onclick="rate(1)"></i>
                    <i class="fas fa-star stars" onclick="rate(2)"></i>
                    <i class="fas fa-star stars" onclick="rate(3)"></i>
                    <i class="fas fa-star stars" onclick="rate(4)"></i>
                    <i class="fas fa-star stars" onclick="rate(5)"></i>
                </div>
                <p id="thx" style="display:none; color:green; font-size:12px;">Feedback submitted!</p>
                <button style="margin-top:15px; padding:8px 20px; background:var(--maroon); color:white; border:none; border-radius:5px; cursor:pointer;" onclick="showMainBot()">New Chat</button>
            </div>`;
    }

    function rate(n) {
        document.querySelectorAll('.stars').forEach((s, i) => s.classList.toggle('active', i < n));
        document.getElementById('thx').style.display = "block";
    }

    function addMsg(t, s) {
        const d = document.createElement('div'); d.className = `msg ${s}`; d.innerHTML = t;
        flow.appendChild(d); flow.scrollTop = flow.scrollHeight;
    }

    function addChips(opts) {
        const cb = document.createElement('div'); cb.className = "chip-box";
        opts.forEach(o => {
            const c = document.createElement('div'); c.className = "chip"; c.innerText = o;
            c.onclick = () => {
                if(o === "Main Menu") showMainBot();
                else if(o === "End Chat") triggerRating();
                else if(o === "Yes, thanks!") { addMsg(o, "user"); setTimeout(() => { addMsg("Great! Anything else?", "bot"); addChips(["Main Menu"]); }, 400); }
                else if(o === "No, Speak to Executive") handleLogic("Speak to Executive");
                else handleLogic(o);
            };
            cb.appendChild(c);
        });
        flow.appendChild(cb); flow.scrollTop = flow.scrollHeight;
    }

    function sendInput() {
        const v = userIn.value.trim(); if(!v) return;
        if(captureStep > 0) handleCapture(v); 
        else if(isConnectedToExec) {
            addMsg(v, "user");
            setTimeout(() => addMsg("Checking that for you. Please wait...", "bot"), 1000);
        }
        else handleLogic(v);
        userIn.value = "";
    }
    function checkKey(e) { if(e.key === 'Enter') sendInput(); }
</script>
</body>
</html>