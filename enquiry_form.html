<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Full-Page School Enrollment Form (Final Logic)</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
    
    <style>
        /* ================================================= */
        /* === ðŸŽ¨ FULL-PAGE & FORM STYLING === */
        /* ================================================= */
        body {
            background-color: #f8f9fa;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 30px 15px;
        }

        .form-container {
            background-color: #ffffff;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 900px;
        }
        
        h1 {
            color: #34495e;
            margin-bottom: 30px;
        }

        .confirmation-group {
            border: 1px solid #dcdcdc;
            padding: 15px;
            border-radius: 5px;
            background-color: #ecf0f1; 
            margin-top: 20px;
        }
        
        #submitBtn {
            font-weight: bold;
        }

        /* ================================================= */
        /* === ðŸ¥³ CONFETTI ANIMATION (Dynamic Origin) === */
        /* ================================================= */

        /* Container for Confetti in SweetAlert */
        .swal2-container.confetti-active {
            overflow: hidden;
        }
        
        /* The Confetti itself */
        .confetti {
            position: fixed;
            width: 8px;
            height: 8px;
            background: #ffeb3b; 
            border-radius: 50%;
            opacity: 0; 
            pointer-events: none;
            z-index: 99999;
        }

        /* Confetti Animation: Blast up and fall */
        @keyframes blast-and-fall {
            0% { 
                transform: translate(0, 0) rotate(0deg); 
                opacity: 1; 
            }
            10% { 
                transform: translate(calc(var(--x) * 0.5), calc(var(--y) * 0.8)) rotate(var(--r-blast));
                opacity: 1;
            }
            100% { 
                transform: translate(calc(var(--x) * 1.5), 100vh) rotate(var(--r-fall)); 
                opacity: 0;
            }
        }
    </style>
</head>
<body>

    <h1 class="text-center">Admission Inquiry</h1>

    <div class="form-container">
        <form id="inquiryForm" class="row g-4 needs-validation" novalidate>
            
            <div class="col-md-6">
                <label for="studentName" class="form-label">Student Name</label>
                <input type="text" class="form-control" id="studentName" name="studentName" required>
                <div class="invalid-feedback">Please enter the student's name.</div>
            </div>
            <div class="col-md-6">
                <label for="dob" class="form-label">Date of Birth</label>
                <input type="date" class="form-control" id="dob" name="dob" required>
                <div class="invalid-feedback">Please select the student's date of birth.</div>
                <small id="ageHelp" class="form-text text-muted mt-1">
                    Age: <span id="calculatedAge" class="fw-bold text-success">--</span>
                </small>
            </div>

            <div class="col-md-6">
                <label for="fatherGuardianName" class="form-label">Father / Guardian Name</label>
                <input type="text" class="form-control" id="fatherGuardianName" name="fatherGuardianName" required>
                <div class="invalid-feedback">Please enter the guardian's name.</div>
            </div>
            <div class="col-md-6">
                <label for="parentEmail" class="form-label">Email Address</label>
                <input type="email" class="form-control" id="parentEmail" name="parentEmail" required>
                <div class="invalid-feedback">Please provide a valid email address.</div>
            </div>
            
            <div class="col-md-6">
                <label for="mobile" class="form-label">Mobile Number</label>
                <input type="tel" class="form-control" id="mobile" name="mobile" pattern="[0-9]{10}" title="Enter a 10-digit mobile number" required>
                <div class="invalid-feedback">Please enter a 10-digit mobile number.</div>
            </div>
            <div class="col-md-6">
                <label for="currentSchool" class="form-label">Current School Name</label>
                <input type="text" class="form-control" id="currentSchool" name="currentSchool" required>
                <div class="invalid-feedback">Please enter the current school name.</div>
            </div>

            <div class="col-md-6">
                <label for="admitClass" class="form-label">Seeking Admission In Class</label>
                <select id="admitClass" name="admitClass" class="form-select" required>
                    <option value="">-- Select Class --</option>
                </select>
                <div class="invalid-feedback">Please select the desired class for admission.</div>
            </div>
            <div class="col-md-6">
                <label for="lastClass" class="form-label">Last Class Attended</label>
                <select id="lastClass" name="lastClass" class="form-select" required disabled>
                    <option value="">-- Select Class --</option>
                </select>
                <div class="invalid-feedback">Please select the last class attended.</div>
            </div>

            <div class="col-12">
                <label for="address" class="form-label">Full Address</label>
                <textarea class="form-control" id="address" name="address" rows="2" required></textarea>
                <div class="invalid-feedback">Please enter the full address.</div>
            </div>

            <div class="col-12 confirmation-group">
                <div class="form-check mb-3">
                    <input class="form-check-input" type="checkbox" id="privacyConfirm">
                    <label class="form-check-label" for="privacyConfirm" style="font-size: 0.9em; color: #2980b9;">
                        I confirm that you can communicate with me via email/mobile. The data provided will <b>not be shared with any third party.</b>
                    </label>/b
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="recaptchaConfirm">
                    <label class="form-check-label fw-bold" for="recaptchaConfirm">
                        I am not a robot (reCAPTCHA)
                    </label>
                </div>
            </div>
            
            <div class="col-12 mt-4">
                <button type="submit" id="submitBtn" class="btn btn-warning btn-lg w-100" disabled>
                    Submit Enrollment Inquiry
                </button>
            </div>
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <script>
        const form = document.getElementById('inquiryForm');
        const privacyConfirm = document.getElementById('privacyConfirm');
        const recaptchaConfirm = document.getElementById('recaptchaConfirm');
        const submitBtn = document.getElementById('submitBtn');
        const admitClassSelect = document.getElementById('admitClass');
        const lastClassSelect = document.getElementById('lastClass');
        const dobInput = document.getElementById('dob');
        const calculatedAgeSpan = document.getElementById('calculatedAge');
        // Class list including Pre-Primary classes for index mapping
        const classOptionsMap = [
            'Nursery', 'LKG', 'HKG', 'Grade 1', 'Grade 2', 'Grade 3', 'Grade 4', 
            'Grade 5', 'Grade 6', 'Grade 7', 'Grade 8', 'Grade 9', 'Grade 10', 'Grade 11'
        ];
        
        const confettiColors = ['#ffeb3b', '#e91e63', '#2196f3', '#00bcd4', '#ff9800', '#4caf50'];
        
        // --- Helper Functions ---

        function populateClassDropdowns() {
            admitClassSelect.innerHTML = '<option value="">-- Select Class --</option>';
            lastClassSelect.innerHTML = '<option value="">-- Select Class --</option>';
            
            classOptionsMap.forEach(className => {
                const optionAdmit = new Option(className, className);
                admitClassSelect.add(optionAdmit);

                const optionLast = new Option(className, className);
                lastClassSelect.add(optionLast);
            });
        }
        
        /**
         * Dynamically updates the "Last Class Attended" dropdown based on the "Admission Class" selection.
         * RULE: Last Class Attended must be Admission Class (0), Admission Class -1, or Admission Class -2.
         */
        function updateLastClassOptions() {
            const admittedClass = admitClassSelect.value;
            // Get the index of the class seeking admission
            const admittedIndex = classOptionsMap.indexOf(admittedClass);
            
            let shouldResetLastClass = false; 
            const selectedLastClass = lastClassSelect.value;

            lastClassSelect.disabled = !admittedClass;
            
            for (let i = 1; i < lastClassSelect.options.length; i++) {
                const option = lastClassSelect.options[i];
                const optionValue = option.value;
                const optionIndex = classOptionsMap.indexOf(optionValue);
                
                // Allowed indices: admittedIndex, admittedIndex - 1, admittedIndex - 2
                const isAllowed = admittedClass && 
                                  (optionIndex === admittedIndex || 
                                   optionIndex === admittedIndex - 1 || 
                                   optionIndex === admittedIndex - 2);

                if (isAllowed) {
                    // Enable the allowed classes
                    option.disabled = false;
                    option.style.backgroundColor = '';
                    option.style.color = '';
                } else {
                    // Disable all other classes (above +0 and below -2)
                    option.disabled = true; 
                    option.style.backgroundColor = '#f8d7da'; 
                    option.style.color = '#721c24';
                    
                    if (optionValue === selectedLastClass) {
                         shouldResetLastClass = true; // Mark for reset if current selection is invalid
                    }
                }
            }
            
            // If the previously selected "Last Class" is now invalid or no admission class is selected, reset the dropdown
            if (shouldResetLastClass || !admittedClass) {
                 lastClassSelect.value = "";
            }
        }

        function calculateAge(dobString) {
            if (!dobString) {
                calculatedAgeSpan.textContent = '--';
                return;
            }
            
            const birthDate = new Date(dobString);
            const today = new Date();
            
            let age = today.getFullYear() - birthDate.getFullYear();
            const monthDifference = today.getMonth() - birthDate.getMonth();
            
            if (monthDifference < 0 || (monthDifference === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }
            
            if (age >= 0 && age < 100) {
                calculatedAgeSpan.textContent = `${age} years old`;
            } else {
                calculatedAgeSpan.textContent = 'Invalid date';
            }
        }
        
        // --- Dynamic Confetti Logic for SweetAlert Origin ---

        function startConfetti() {
            const swalContainer = document.querySelector('.swal2-modal');
            if (!swalContainer) return; 

            const rect = swalContainer.getBoundingClientRect();
            const startX = rect.left; 
            const startY = rect.bottom; 

            const numConfetti = 50;
            const container = document.body;
            container.classList.add('confetti-active');
            
            for (let i = 0; i < numConfetti; i++) {
                const confetti = document.createElement('div');
                confetti.classList.add('confetti');
                
                const duration = 2.5 + Math.random() * 1.5; 
                const delay = Math.random() * 0.5; 
                const travelX = 300 + Math.random() * 600; 
                const travelY = -(startY - (Math.random() * 100 + 50)); 
                const rotateBlast = Math.random() * 360;
                const rotateFall = 720 + Math.random() * 720;
                
                confetti.style.backgroundColor = confettiColors[i % confettiColors.length];
                
                confetti.style.top = `${startY}px`;
                confetti.style.left = `${startX}px`;

                confetti.style.setProperty('--x', `${travelX}px`);
                confetti.style.setProperty('--y', `${travelY}px`);
                confetti.style.setProperty('--r-blast', `${rotateBlast}deg`);
                confetti.style.setProperty('--r-fall', `${rotateFall}deg`);
                
                confetti.style.animation = `blast-and-fall ${duration}s ease-in-out ${delay}s forwards`;
                
                container.appendChild(confetti);
            }
            
            setTimeout(stopConfetti, 5000); 
        }
        
        function stopConfetti() {
            document.body.classList.remove('confetti-active');
            document.querySelectorAll('.confetti').forEach(c => c.remove());
        }

        // --- Core Logic ---
        
        function checkSubmitButtonStatus() {
            if (privacyConfirm.checked && recaptchaConfirm.checked) {
                submitBtn.disabled = false;
                submitBtn.classList.remove('btn-warning');
                submitBtn.classList.add('btn-success');
            } else {
                submitBtn.disabled = true;
                submitBtn.classList.add('btn-warning');
                submitBtn.classList.remove('btn-success');
            }
        }

        // --- Event Listeners ---
        
        admitClassSelect.addEventListener('change', updateLastClassOptions);
        dobInput.addEventListener('change', function() {
            calculateAge(this.value);
        });

        privacyConfirm.addEventListener('change', checkSubmitButtonStatus);
        recaptchaConfirm.addEventListener('change', checkSubmitButtonStatus);


        // --- Handle Form Submission (Simplified) ---
        form.addEventListener('submit', async function(event) {
            event.preventDefault(); 
            
            form.classList.add('was-validated');
            
            if (!form.checkValidity() || submitBtn.disabled) {
                event.stopPropagation();
                Swal.fire({
                    icon: 'error',
                    title: 'Form Incomplete',
                    text: 'Please fill all required fields and check both confirmation boxes.',
                    confirmButtonColor: '#3498db'
                });
                return;
            } 

            // Show SweetAlert final success message
            await Swal.fire({
                icon: 'success',
                title: 'Inquiry Sent Successfully!',
                html: '<p>Thank you for your interest. A school counselor will contact you at your email/mobile number shortly.</p>',
                confirmButtonText: 'Great!',
                confirmButtonColor: '#27ae60', 
                allowOutsideClick: false,
                allowEscapeKey: false,
                backdrop: `rgba(0,0,0,0.4)`,
                
                didOpen: () => {
                    // Confetti blasts from the bottom-left of the newly opened SweetAlert box
                    startConfetti();
                },
                willClose: () => {
                    // Clean up confetti when the user closes the message
                    stopConfetti(); 
                }
            });
            
            // Reset state
            form.reset();
            form.classList.remove('was-validated');
            populateClassDropdowns();
            updateLastClassOptions();
            calculateAge('');
            checkSubmitButtonStatus();
        });

        // --- Initialization ---
        populateClassDropdowns();
        updateLastClassOptions(); 
        checkSubmitButtonStatus();
    </script>

</body>
</html>